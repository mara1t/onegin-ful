#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <string.h>
#include <io.h>


int fl_size (FILE* og);

int min (int a, int b);
int max (int a, int b);
void swap (int* a, int* b);
FILE* file_cin();
char* file_read (int file_size, FILE* og);
int pointer_1str (int file_size, char *symbols, char** psymbols);
void print_txt (int n_str, char** psymbols);
void str_compare(int n_str, char* symbols, char** psymbols);

FILE* og;

int main()
{
    int j = 1, i = 0, s = 1, n_str = 0, len = 0, file_size = 1000;

    char* swaps;

    og = file_cin();

    file_size = fl_size(og);

    char* symbols = file_read(file_size, og);

    char* psymbols[file_size];

    n_str = pointer_1str (file_size, symbols, psymbols);

    print_txt (n_str, psymbols);

    str_compare (n_str, symbols, psymbols) ;

    printf("***\nNOW PRINT SORTED ONEGIN:\n***");

    print_txt(n_str, psymbols);
    
    fclose(og);
    return 0;
}

int fl_size (FILE* og)
{
    if (og == NULL)
    {
        printf ("ERROR");
        return -1;
    }

    fseek (og, 0, SEEK_END);

    int size = ftell (og);

    fseek (og, 0, SEEK_SET);

    return (size);
}

int min(int a, int b)
{
    return (a>b)? b:a;
}

int max(int a, int b)
{
    return (a>b) ? a:b;
}
void swap(int* a, int* b)
{
    int t = *a;
    *a = *b;
    *b = t;
}
void str_compare(int n_str, char* symbols, char** psymbols)
{
    int i = 0, j = 1, s = 1, len = 0;

    char* swaps;

    for (i = n_str - 2; i >= 0; i--)
    {
        for(j = 0; j <= i; j++)
        {
            len = 0;
            s= 1;
            while (s == 1)
            {
                if ( *(psymbols[j]+len) > *(psymbols[j+1]+len))
                {
                    swaps = psymbols[j];
                    psymbols[j] = psymbols[j+1];
                    psymbols[j+1] = swaps;
                    s = 0;
                }
                if (*(psymbols[j]+len) < *(psymbols[j+1]+len))
                {
                    s = 0;
                }
                if ( *(psymbols[j]+len) == *(psymbols[j+1]+len))
                {
                    len++;
                }
            }
        }
    }

}

FILE* file_cin()
{
    FILE* og = NULL;
    og = fopen("C:\\Users\\User\\Desktop\\проги\\textin.txt", "r");
    return og;
}

char* file_read (int file_size, FILE* og)
{
    char* symbols = (char *) calloc(file_size, sizeof(char));
    fread(symbols, 1, file_size, og);
    return symbols;
}

int pointer_1str (int file_size, char *symbols, char** psymbols)
{
    int i = 0, n_str = 0, j = 0;
    for (j = 0; i < file_size; j++)
    {
        psymbols[j] = &symbols[i];
        while ( symbols[i] != '\n')
        {
        i++;
        }
        i++;
        n_str = j+1;
    }
    return n_str;
}

void print_txt (int n_str, char** psymbols)
{
    int i, j;
    for (i = 0; i < n_str; i++)
    {
        for (j = 0; *(psymbols[i]+j) != '\n'; j++)
        {
            printf("%c", *(psymbols[i]+j));
        }
        printf("\n");
    }
}
